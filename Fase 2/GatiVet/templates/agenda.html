{% extends "base.html" %}

{% block title %}Contacto{% endblock %}

{% block content %}

<!-- Body-->
<body class="bg-gray-100">
    <div class="max-w-5xl mx-auto my-10 p-6 bg-white shadow-md rounded-lg">
        <!-- Pasos de progreso -->
        <div class="step-container">
            <div class="step-wrapper">
                <!-- Primer paso: Identificación -->
                <div class="flex flex-col items-center">
                    <i class="fas fa-id-card step-icon" id="id-icon"></i>
                    <span class="step-icon-name text-sm" id="id-icon-name">Identificación</span>
                </div>
                <div class="flex flex-col items-center">
                    <i class="fas fa-search step-icon" id="search-icon"></i>
                    <span class="step-icon-name text-sm" id="search-icon-name">Buscar</span>
                </div>
                <div class="flex flex-col items-center">
                    <i class="fas fa-check step-icon" id="select-icon"></i>
                    <span class="step-icon-name text-sm" id="select-icon-name">Seleccionar Fecha y Hora</span>
                </div>
                <div class="flex flex-col items-center"></div>
                    <i class="fas fa-paw step-icon" id="pet-icon"></i>
                    <span class="step-icon-name text-sm" id="pet-icon-name">Datos de Mascota</span>
                </div>
                <div class="flex flex-col items-center">
                    <i class="fas fa-thumbs-up step-icon" id="success-icon"></i>
                    <span class="step-icon-name text-sm" id="success-icon-name">Éxito</span>
                </div>
            </div>
        </div>

        <!-- Form Sections -->
        <div id="form-steps">

            <!-- Identificación -->
            <div class="step-content p-6 bg-white shadow-md rounded-lg active" id="step-id">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Identificación</h2>
                <p class="text-gray-700 mb-4">Ingrese su RUT para continuar:</p>
                <input type="text" id="rut-input" placeholder="Ingrese su RUT"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400 mb-4"
                    oninput="formatRut()">
                <div class="text-center mt-6">
                    <button onclick="
                        const rut = document.getElementById('rut-input').value;
                        if (!isValidRut(rut)) {
                            alert('Por favor, ingrese un RUT válido en el formato xx.xxx.xxx-x.');
                            return;
                        }
                        nextStep('step-id', 'step-search', 'id-icon');
                    "
                    class="px-6 py-3 bg-[#18beaa] hover:bg-[#16a89a] text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition duration-300 ease-in-out transition-transform transform-gpu hover:-translate-y-1 hover:shadow-lg cursor-pointer">
                        Siguiente
                    </button>
                </div>
            </div>
            <!-- Fin Identificación -->

            <!-- Búsqueda -->
            <div class="step-content hidden p-6 bg-white shadow-md rounded-lg" id="step-search">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-start">
                    <div class="col-span-1 mb-6">
                        <!-- Selección de comuna -->
                        <h3 class="text-xl font-semibold text-gray-700 mb-3">Seleccionar comuna:</h3>
                        <select id="comuna-select"
                                class="block w-full border border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="puentealto">Puente Alto</option>
                            <option value="lapintana">La Pintana</option>
                            <option value="laflorida">La Florida</option>
                        </select>
                    
                        <!-- Selección de Área -->
                        <h3 class="text-xl font-semibold text-gray-700 mt-6 mb-3">Seleccionar área:</h3>
                        <select id="area-select"
                                class="block w-full border border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <option value="general">Consulta General</option>
                            <option value="especialidad">Consulta Especialidad Felina</option>
                            <option value="telemedicina">Consulta Telemedicina</option>
                        </select>
                    </div>

                    <!-- Contenedor para Divisor Vertical y Buscar por -->
                    <div class="col-span-2 flex flex-col mb-6">
                        <div class="flex items-start mb-6">
                            <!-- Divisor Vertical -->
                            <div class="hidden md:block w-px h-40 bg-gray-300 mr-6"></div>

                            <!-- Buscar por -->
                            <div class="w-full">
                                <h3 class="text-xl font-semibold text-gray-700 mb-3">Buscar por:</h3>
                                <div class="flex space-x-4 mb-4">
                                    <label class="inline-flex items-center">
                                        <input type="radio" name="search-type" value="staff" onclick="toggleSearch('staff')"
                                               class="form-radio text-blue-500 border-gray-300 focus:border-blue-500 focus:ring-blue-500">
                                        <span class="ml-2 text-gray-700">Staff</span>
                                    </label>
                                </div>

                                <!-- Búsqueda por Servicio y Staff en una fila -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Búsqueda por Servicio para el futuro -->
                                    <div id="service-search" class="hidden">
                                        <!-- Añadir más opciones según sea necesario -->
                                    </div>

                                    <!-- Búsqueda por Staff -->
                                    <div id="staff-search" class="hidden">
                                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Seleccionar Doctor:</h3>
                                        <select id="staff-select"
                                                class="block w-full border border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                onchange="updateDoctorInfoFromSelection()">
                                            <option value="none" selected>Seleccione un doctor</option>
                                            <option value="doctor1" data-name="Dr. Nicolás Villalba"
                                                    data-image="static/img/doctor1.jpg">Dr. Nicolás Villalba</option>
                                            <option value="doctor2" data-name="Dra. Kirito Aravena"
                                                    data-image="static/img/doctor2.jpg">Dra. Kirito Aravena</option>
                                            <!-- Añadir más opciones según sea necesario -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botón principal "Pedir Hora" -->
                <div class="text-center mt-6">
                    <button onclick="
                        const doctorSelected = document.getElementById('staff-select').value;
                        if (doctorSelected === 'none') {
                            alert('Por favor, seleccione un doctor.');
                            return;
                        }
                        nextStep('step-search', 'step-select', 'search-icon');
                    "
                    class="px-6 py-3 bg-[#18beaa] hover:bg-[#16a89a] text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition duration-300 ease-in-out transition-transform transform-gpu hover:-translate-y-1 hover:shadow-lg cursor-pointer">
                        Pedir Hora
                    </button>
                </div>
            </div>
            <!-- Fin Búsqueda -->

            <!-- Selección -->
            <div class="step-content hidden p-6 bg-white shadow-md rounded-lg" id="step-select">
                <p class="text-gray-700 mb-4">Seleccione la fecha y hora para su cita con el profesional seleccionado:</p>

                <div class="flex items-start">
                    <!-- Imagen del Doctor Seleccionado -->
                    <div class="w-1/3 mr-6 text-center">
                        <img id="doctor-image" src="static/img/Logo Gativet.png" alt="Imagen del Doctor"
                             class="w-full h-auto rounded-lg shadow-md">
                        <!-- Nombre del Doctor -->
                        <p id="doctor-name" class="mt-2 text-gray-800 font-semibold">Nombre del Doctor</p>
                    </div>

                    <!-- Selección de Fecha y Horas Disponibles -->
                    <div class="w-2/3">
                        <!-- Selección de Fecha -->
                        <div class="mb-4">
                            <label for="date-select" class="block text-gray-700 mb-2">Selecciona una fecha:</label>
                            <input type="date" id="date-select"
                                   class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                        </div>

                        <!-- Selección de Hora -->
                        <div class="mb-4">
                            <label for="time-select" class="block text-gray-700 mb-2">Selecciona una hora:</label>
                            <select id="time-select"
                                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                                <!-- Opciones de horas (ejemplo) -->
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6">
                    <button onclick="nextStep('step-select', 'step-pet', 'select-icon')"
                    class="px-6 py-3 bg-[#18beaa] hover:bg-[#16a89a] text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition duration-300 ease-in-out transition-transform transform-gpu hover:-translate-y-1 hover:shadow-lg cursor-pointer">
                        Siguiente
                    </button>
                </div>
            </div>
            <!-- Fin Selección -->

            <!-- Datos de Mascota -->
            <div class="step-content hidden p-6 bg-white shadow-md rounded-lg" id="step-pet">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Datos de Mascota</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Nombre de la Mascota -->
                    <div class="mb-6">
                        <label for="pet-name" class="block text-gray-700 mb-2">Nombre de la Mascota:</label>
                        <input type="text" id="pet-name" placeholder="Nombre de la Mascota"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                    </div>

                    <!-- Edad de la Mascota -->
                    <div class="mb-6">
                        <label for="pet-age" class="block text-gray-700 mb-2">Edad de la Mascota:</label>
                        <input type="number" id="pet-age" placeholder="Edad de la Mascota"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                    </div>

                    <!-- Especie de la Mascota -->
                    <div class="mb-6">
                        <label for="pet-species" class="block text-gray-700 mb-2">Especie:</label>
                        <select id="pet-species"
                                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400">
                            <option value="dog">Perro</option>
                            <option value="cat">Gato</option>
                            <option value="other">Otro</option>
                        </select>
                    </div>

                    <!-- Problema de Salud -->
                    <div class="mb-6">
                        <label for="health-issue" class="block text-gray-700 mb-2">Problema de Salud:</label>
                        <textarea id="health-issue" rows="4" placeholder="Descripción del problema de salud"
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-400"></textarea>
                    </div>
                </div>
                
                <!-- Botón de Siguiente -->
                <div class="text-center mt-6">
                    <button onclick="nextStep('step-pet', 'step-success', 'pet-icon')"
                    class="px-6 py-3 bg-[#18beaa] hover:bg-[#16a89a] text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition duration-300 ease-in-out transition-transform transform-gpu hover:-translate-y-1 hover:shadow-lg cursor-pointer">
                        Siguiente
                    </button>
                </div>
            </div>
            <!-- Fin Datos de Mascota -->

            <!-- Éxito -->
            <div class="step-content hidden p-6 bg-white shadow-md rounded-lg" id="step-success">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">¡Éxito!</h2>
                <p class="text-gray-700 mb-4">Tu cita ha sido reservada exitosamente. Recibirás una confirmación por correo electrónico.</p>
                <div class="text-center mt-6">
                    <button onclick="window.location.href='/'"
                    class="px-6 py-3 bg-[#18beaa] hover:bg-[#16a89a] text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 transition duration-300 ease-in-out transition-transform transform-gpu hover:-translate-y-1 hover:shadow-lg cursor-pointer">
                        Volver al Inicio
                    </button>
                </div>
            </div>
            <!-- Fin Éxito -->
        </div>
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
<script>
// Función para avanzar al siguiente paso
function nextStep(currentStepId, nextStepId, iconId) {
    document.getElementById(currentStepId).classList.add('hidden');
    document.getElementById(nextStepId).classList.remove('hidden');
    document.getElementById(iconId).classList.add('text-green-500');
}

// Función para validar el RUT
function isValidRut(rut) {
    // Limpia el RUT de puntos y guion
    rut = rut.replace(/[.\-]/g, '');

    // Verifica la longitud mínima y máxima del RUT
    if (rut.length < 8 || rut.length > 9) {
        return false;
    }

    // Extrae el cuerpo y el dígito verificador
    let body = rut.slice(0, -1);
    let checkDigit = rut.slice(-1).toUpperCase();

    // Calcula el dígito verificador
    let sum = 0;
    let multiplier = 2;

    for (let i = body.length - 1; i >= 0; i--) {
        sum += parseInt(body[i]) * multiplier;
        multiplier = (multiplier % 7) + 1;
    }

    let calculatedDigit = 11 - (sum % 11);
    if (calculatedDigit === 11) calculatedDigit = '0';
    if (calculatedDigit === 10) calculatedDigit = 'K';

    return calculatedDigit === checkDigit;
}

// Función para formatear el RUT (opcional)
function formatRut() {
    let rutInput = document.getElementById('rut-input');
    let rut = rutInput.value.replace(/[.\-]/g, '');
    
    // Formatea el RUT en el formato xx.xxx.xxx-x
    if (rut.length > 1) {
        rut = rut.slice(0, -1) + '-' + rut.slice(-1);
    }
    if (rut.length > 6) {
        rut = rut.slice(0, -4) + '.' + rut.slice(-4);
    }
    if (rut.length > 10) {
        rut = rut.slice(0, -8) + '.' + rut.slice(-8);
    }
    
    rutInput.value = rut;
}

// Función para mostrar/ocultar la búsqueda por servicio o staff
function toggleSearch(type) {
    document.getElementById('service-search').classList.toggle('hidden', type !== 'service');
    document.getElementById('staff-search').classList.toggle('hidden', type !== 'staff');
}

// Función para actualizar la información del doctor seleccionado
function updateDoctorInfoFromSelection() {
    const selectElement = document.getElementById('staff-select');
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    const doctorImage = document.getElementById('doctor-image');
    const doctorName = document.getElementById('doctor-name');

    doctorImage.src = selectedOption.getAttribute('data-image');
    doctorName.textContent = selectedOption.getAttribute('data-name');
}
</script>

{% endblock %}
